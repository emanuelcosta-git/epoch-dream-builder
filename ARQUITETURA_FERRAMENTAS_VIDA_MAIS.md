# üèóÔ∏è **ARQUITETURA DE FERRAMENTAS - SISTEMA VIDA MAIS**

## üéØ **VIS√ÉO GERAL DA ARQUITETURA**

Este documento define a **Arquitetura de Ferramentas** que ser√° utilizada para construir o Sistema Vida Mais, integrando **LOVABLE** para desenvolvimento r√°pido e **Supabase** para infraestrutura de dados, criando uma solu√ß√£o robusta e escal√°vel.

---

## üöÄ **STACK TECNOL√ìGICO PRINCIPAL**

### **1. FRONTEND - LOVABLE**
- **Framework**: LOVABLE (Low-Code Visual Application Builder)
- **Linguagem**: JavaScript/TypeScript
- **Interface**: Componentes visuais drag-and-drop
- **Responsividade**: Design mobile-first
- **Tema**: Material Design ou customizado

### **2. BACKEND - SUPABASE**
- **Banco de Dados**: PostgreSQL (gerenciado)
- **Autentica√ß√£o**: Supabase Auth
- **API**: REST e GraphQL autom√°ticos
- **Storage**: Arquivos e documentos
- **Real-time**: Subscriptions em tempo real

### **3. INFRAESTRUTURA**
- **Hospedagem**: Supabase Cloud
- **CDN**: Global edge network
- **SSL**: Certificados autom√°ticos
- **Backup**: Autom√°tico e cont√≠nuo

---

## üé® **ARQUITETURA FRONTEND - LOVABLE**

### **1. Estrutura de Componentes**

```
üìÅ LOVABLE_APP/
‚îú‚îÄ‚îÄ üé® COMPONENTES_VISUAIS/
‚îÇ   ‚îú‚îÄ‚îÄ üìä Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ üìù Formul√°rios
‚îÇ   ‚îú‚îÄ‚îÄ üìã Tabelas
‚îÇ   ‚îú‚îÄ‚îÄ üìà Gr√°ficos
‚îÇ   ‚îî‚îÄ‚îÄ üîî Notifica√ß√µes
‚îú‚îÄ‚îÄ üîó INTEGRA√á√ïES/
‚îÇ   ‚îú‚îÄ‚îÄ Supabase Client
‚îÇ   ‚îú‚îÄ‚îÄ Email Service
‚îÇ   ‚îî‚îÄ‚îÄ File Upload
‚îî‚îÄ‚îÄ ‚öôÔ∏è CONFIGURA√á√ïES/
    ‚îú‚îÄ‚îÄ Tema e Cores
    ‚îú‚îÄ‚îÄ Responsividade
    ‚îî‚îÄ‚îÄ Internacionaliza√ß√£o
```

### **2. Componentes Principais**

#### **Dashboard Executivo**
- **Tecnologia**: LOVABLE Charts + Supabase Real-time
- **Funcionalidades**: 
  - M√©tricas em tempo real
  - Gr√°ficos de aprova√ß√£o
  - Indicadores de performance
  - Alertas autom√°ticos

#### **Formul√°rios de Pagamento**
- **Tecnologia**: LOVABLE Forms + Supabase Validation
- **Funcionalidades**:
  - Valida√ß√£o em tempo real
  - Upload de arquivos
  - Autocomplete de campos
  - Valida√ß√£o de or√ßamento

#### **Tabelas de Dados**
- **Tecnologia**: LOVABLE DataGrid + Supabase Queries
- **Funcionalidades**:
  - Pagina√ß√£o autom√°tica
  - Filtros avan√ßados
  - Ordena√ß√£o din√¢mica
  - Exporta√ß√£o Excel/PDF

### **3. Responsividade e UX**
- **Mobile-First**: Design responsivo para todos os dispositivos
- **Progressive Web App**: Funcionalidade offline b√°sica
- **Accessibility**: Conformidade com WCAG 2.1
- **Performance**: Lazy loading e otimiza√ß√µes

---

## üóÑÔ∏è **ARQUITETURA BACKEND - SUPABASE**

### **1. Estrutura do Banco de Dados**

```sql
-- TABELAS PRINCIPAIS
üìä usuarios (id, email, nome, perfil, ativo)
üìä projetos (id, nome, descricao, orcamento_anual)
üìä pagamentos_fixos (id, descricao, valor, tipo, status)
üìä pagamentos_variaveis (id, descricao, valor, classificacao, status)
üìä anexos (id, pagamento_id, arquivo, tipo)
üìä logs_aprovacao (id, pagamento_id, usuario_id, acao, timestamp)
üìä configuracoes (id, chave, valor, descricao)

-- POL√çTICAS RLS (Row Level Security)
üîí usuarios: usu√°rio s√≥ v√™ seus pr√≥prios dados
üîí projetos: usu√°rio s√≥ v√™ projetos associados
üîí pagamentos: baseado no perfil e projeto do usu√°rio
üîí logs: apenas administradores e auditores
```

### **2. Autentica√ß√£o e Autoriza√ß√£o**

#### **Supabase Auth**
- **M√©todos**: Email/Senha, Magic Link, OAuth
- **Perfis**: ariela, estagiario, sonia, ze, renata, admin
- **Sess√µes**: JWT com refresh autom√°tico
- **MFA**: Autentica√ß√£o de dois fatores

#### **Row Level Security (RLS)**
```sql
-- Exemplo de pol√≠tica RLS
CREATE POLICY "Usu√°rios veem apenas seus dados" ON usuarios
FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Pagamentos baseados no projeto" ON pagamentos_fixos
FOR ALL USING (
  projeto_id IN (
    SELECT projeto_id FROM usuarios_projetos 
    WHERE usuario_id = auth.uid()
  )
);
```

### **3. APIs Autom√°ticas**

#### **REST API**
- **Endpoints**: Autom√°ticos para todas as tabelas
- **M√©todos**: GET, POST, PUT, DELETE
- **Valida√ß√£o**: Schema validation autom√°tico
- **Rate Limiting**: Configur√°vel por usu√°rio

#### **GraphQL API**
- **Queries**: Consultas complexas e relacionamentos
- **Mutations**: Opera√ß√µes de escrita
- **Subscriptions**: Dados em tempo real
- **Schema**: Auto-gerado baseado no banco

### **4. Storage e Arquivos**

#### **Supabase Storage**
- **Buckets**: 
  - `notas-fiscais` (PDFs, imagens)
  - `documentos` (contratos, relat√≥rios)
  - `anexos` (arquivos diversos)
- **Pol√≠ticas**: Acesso baseado em permiss√µes
- **CDN**: Distribui√ß√£o global autom√°tica
- **Versionamento**: Hist√≥rico de arquivos

---

## üîó **INTEGRA√á√ïES E SERVI√áOS**

### **1. Sistema de Email**

#### **Supabase Edge Functions + Nodemailer**
```javascript
// Exemplo de fun√ß√£o para envio de emails
export async function enviarEmailAprovacao(pagamento) {
  const { data, error } = await supabase
    .from('pagamentos_fixos')
    .select('*')
    .eq('id', pagamento.id)
    .single();
    
  if (error) throw error;
  
  // Enviar email via Nodemailer
  await transporter.sendMail({
    to: 'renata@vidamais.com',
    subject: 'Pagamento Pendente de Aprova√ß√£o',
    html: templateEmail(data)
  });
}
```

#### **Templates de Email**
- **Tecnologia**: Handlebars ou EJS
- **Responsivo**: HTML + CSS inline
- **Vari√°veis**: Dados din√¢micos do pagamento
- **Anexos**: PDFs e documentos

### **2. Relat√≥rios e Exporta√ß√£o**

#### **Excel/PDF Generation**
- **Tecnologia**: SheetJS (Excel) + Puppeteer (PDF)
- **Templates**: Predefinidos para cada tipo de relat√≥rio
- **Dados**: Consultas otimizadas do Supabase
- **Cache**: Relat√≥rios frequentes em cache

#### **Dashboard em Tempo Real**
- **Tecnologia**: Supabase Realtime + LOVABLE Charts
- **Atualiza√ß√µes**: WebSockets para mudan√ßas instant√¢neas
- **Performance**: Debouncing e throttling
- **Offline**: Dados em cache local

### **3. Notifica√ß√µes e Alertas**

#### **Sistema de Notifica√ß√µes**
- **Push**: Notifica√ß√µes do navegador
- **Email**: Notifica√ß√µes autom√°ticas
- **SMS**: Para casos urgentes (via Twilio)
- **In-App**: Notifica√ß√µes na interface

---

## üîí **SEGURAN√áA E COMPLIANCE**

### **1. Controle de Acesso**

#### **Autentica√ß√£o Multi-Fator**
- **M√©todo**: TOTP (Google Authenticator)
- **Configura√ß√£o**: Obrigat√≥rio para perfis admin
- **Backup**: C√≥digos de recupera√ß√£o

#### **Auditoria e Logs**
- **Tabela**: logs_auditoria
- **Campos**: usuario_id, acao, tabela, registro_id, timestamp, ip
- **Reten√ß√£o**: 7 anos (compliance)
- **Exporta√ß√£o**: Relat√≥rios de auditoria

### **2. Criptografia e Prote√ß√£o**

#### **Dados Sens√≠veis**
- **Senhas**: Hash bcrypt (via Supabase Auth)
- **Dados pessoais**: Criptografia AES-256
- **Comunica√ß√£o**: HTTPS/TLS 1.3
- **Backup**: Criptografado em repouso

#### **Rate Limiting**
- **API**: M√°ximo 1000 requests/hora por usu√°rio
- **Upload**: M√°ximo 10MB por arquivo
- **Login**: M√°ximo 5 tentativas por hora
- **Relat√≥rios**: M√°ximo 10 por hora

---

## üì± **ARQUITETURA MOBILE E RESPONSIVA**

### **1. Progressive Web App (PWA)**

#### **Funcionalidades PWA**
- **Instala√ß√£o**: Adicionar √† tela inicial
- **Offline**: Cache de dados essenciais
- **Push Notifications**: Notifica√ß√µes do sistema
- **Background Sync**: Sincroniza√ß√£o em segundo plano

#### **Service Worker**
```javascript
// Cache de recursos est√°ticos
const CACHE_NAME = 'vida-mais-v1';
const urlsToCache = [
  '/',
  '/dashboard',
  '/static/js/bundle.js',
  '/static/css/main.css'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  );
});
```

### **2. Responsividade**

#### **Breakpoints**
- **Mobile**: < 768px
- **Tablet**: 768px - 1024px
- **Desktop**: > 1024px
- **Large**: > 1440px

#### **Componentes Adaptativos**
- **Tabelas**: Scroll horizontal em mobile
- **Formul√°rios**: Campos empilhados em mobile
- **Dashboard**: Cards reorganizados por dispositivo
- **Navega√ß√£o**: Menu hamb√∫rguer em mobile

---

## üöÄ **DEPLOYMENT E INFRAESTRUTURA**

### **1. Ambiente de Desenvolvimento**

#### **Local Development**
- **Supabase Local**: Docker Compose
- **LOVABLE**: Dev server com hot reload
- **Database**: PostgreSQL local
- **Storage**: MinIO local

#### **Staging Environment**
- **Supabase**: Projeto staging separado
- **LOVABLE**: Build de produ√ß√£o
- **Testing**: Dados de teste
- **CI/CD**: Deploy autom√°tico

### **2. Produ√ß√£o**

#### **Supabase Cloud**
- **Regi√£o**: S√£o Paulo (lat√™ncia m√≠nima)
- **Plano**: Pro (para produ√ß√£o)
- **Backup**: Di√°rio autom√°tico
- **Monitoring**: M√©tricas em tempo real

#### **LOVABLE Production**
- **Build**: Otimizado para produ√ß√£o
- **CDN**: Distribui√ß√£o global
- **Compression**: Gzip + Brotli
- **Caching**: Cache agressivo

---

## üìä **MONITORING E ANALYTICS**

### **1. M√©tricas de Performance**

#### **Frontend (LOVABLE)**
- **Core Web Vitals**: LCP, FID, CLS
- **Bundle Size**: Tamanho dos arquivos JS/CSS
- **Load Time**: Tempo de carregamento
- **Error Rate**: Taxa de erros

#### **Backend (Supabase)**
- **Query Performance**: Tempo de resposta
- **Connection Pool**: Uso de conex√µes
- **Storage Usage**: Uso de armazenamento
- **API Latency**: Lat√™ncia das APIs

### **2. Logs e Debugging**

#### **Structured Logging**
```javascript
// Exemplo de log estruturado
logger.info('Pagamento aprovado', {
  pagamento_id: pagamento.id,
  valor: pagamento.valor,
  aprovado_por: usuario.nome,
  timestamp: new Date().toISOString(),
  metadata: {
    projeto: pagamento.projeto_id,
    tipo: pagamento.tipo
  }
});
```

#### **Error Tracking**
- **Sentry**: Captura de erros em tempo real
- **User Context**: Informa√ß√µes do usu√°rio
- **Stack Traces**: Rastreamento completo
- **Performance**: M√©tricas de performance

---

## üîÑ **CI/CD E AUTOMA√á√ÉO**

### **1. Pipeline de Deploy**

#### **GitHub Actions**
```yaml
name: Deploy to Production
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm ci
      - name: Build application
        run: npm run build
      - name: Deploy to Supabase
        run: supabase db push
      - name: Deploy LOVABLE app
        run: npm run deploy
```

### **2. Testes Automatizados**

#### **Testes Unit√°rios**
- **Framework**: Jest
- **Coverage**: M√≠nimo 80%
- **Linting**: ESLint + Prettier
- **Type Checking**: TypeScript

#### **Testes de Integra√ß√£o**
- **API Testing**: Supertest
- **Database Testing**: Testcontainers
- **E2E Testing**: Playwright
- **Performance Testing**: Artillery

---

## üí∞ **CUSTOS E OTIMIZA√á√ÉO**

### **1. Estrutura de Custos**

#### **Supabase**
- **Plano Pro**: $25/m√™s
- **Storage**: $0.021/GB
- **Bandwidth**: $0.09/GB
- **Database**: Inclu√≠do no plano

#### **LOVABLE**
- **Licen√ßa**: $99/m√™s (desenvolvedor)
- **Hosting**: $29/m√™s
- **Support**: $49/m√™s (opcional)

### **2. Otimiza√ß√µes de Custo**

#### **Database**
- **Indexes**: Otimiza√ß√£o de queries
- **Connection Pooling**: Reutiliza√ß√£o de conex√µes
- **Query Optimization**: Consultas eficientes
- **Caching**: Redis para dados frequentes

#### **Storage**
- **Compression**: Gzip para arquivos
- **CDN**: Cache global
- **Lifecycle**: Arquivos antigos para storage frio
- **Cleanup**: Remo√ß√£o autom√°tica de arquivos tempor√°rios

---

## üéØ **ROADMAP DE IMPLEMENTA√á√ÉO**

### **Fase 1: MVP (Meses 1-2)**
- ‚úÖ Configura√ß√£o do Supabase
- ‚úÖ Estrutura b√°sica do banco
- ‚úÖ Autentica√ß√£o b√°sica
- ‚úÖ Interface LOVABLE b√°sica

### **Fase 2: Funcionalidades Core (Meses 3-4)**
- üîÑ Sistema de pagamentos
- üîÑ Processo de aprova√ß√£o
- üîÑ Notifica√ß√µes por email
- üîÑ Relat√≥rios b√°sicos

### **Fase 3: Automa√ß√£o (Meses 5-6)**
- üîÆ Workflows automatizados
- üîÆ Dashboard executivo
- üîÆ M√©tricas e analytics
- üîÆ Sistema de alertas

### **Fase 4: Otimiza√ß√£o (Meses 7-8)**
- üîÆ Performance tuning
- üîÆ Mobile optimization
- üîÆ Advanced security
- üîÆ Monitoring completo

---

## üèÜ **VANTAGENS DA ARQUITETURA**

### **1. LOVABLE**
- ‚úÖ **Desenvolvimento R√°pido**: Interface visual drag-and-drop
- ‚úÖ **Componentes Reutiliz√°veis**: Biblioteca de componentes
- ‚úÖ **Responsividade Nativa**: Mobile-first design
- ‚úÖ **Integra√ß√£o F√°cil**: APIs e servi√ßos externos

### **2. Supabase**
- ‚úÖ **Backend Completo**: Database, Auth, Storage, APIs
- ‚úÖ **Escalabilidade**: Infraestrutura gerenciada
- ‚úÖ **Seguran√ßa**: RLS, Auth, SSL autom√°tico
- ‚úÖ **Real-time**: Subscriptions e WebSockets

### **3. Integra√ß√£o**
- ‚úÖ **Performance**: Otimiza√ß√µes autom√°ticas
- ‚úÖ **Seguran√ßa**: Controle de acesso granular
- ‚úÖ **Manutenibilidade**: C√≥digo limpo e documentado
- ‚úÖ **Escalabilidade**: Crescimento autom√°tico

---

## ‚ö†Ô∏è **CONSIDERA√á√ïES T√âCNICAS**

### **1. Limita√ß√µes**
- **LOVABLE**: Depend√™ncia da plataforma
- **Supabase**: Limites do plano gratuito
- **Integra√ß√£o**: Complexidade de customiza√ß√µes
- **Vendor Lock-in**: Depend√™ncia dos provedores

### **2. Mitiga√ß√µes**
- **Abstra√ß√£o**: Camadas de abstra√ß√£o para mudan√ßas
- **Standards**: Uso de padr√µes web abertos
- **Documenta√ß√£o**: C√≥digo bem documentado
- **Testing**: Testes abrangentes

---

## üéâ **CONCLUS√ÉO**

A arquitetura proposta combina **LOVABLE** para desenvolvimento r√°pido e **Supabase** para infraestrutura robusta, criando uma solu√ß√£o que √©:

‚úÖ **R√°pida de desenvolver** com LOVABLE  
‚úÖ **Escal√°vel e segura** com Supabase  
‚úÖ **Perform√°tica** com otimiza√ß√µes autom√°ticas  
‚úÖ **Manuten√≠vel** com c√≥digo limpo e documentado  
‚úÖ **Custo-efetiva** com planos gerenciados  
‚úÖ **Compliant** com regulamenta√ß√µes de seguran√ßa  

**üèóÔ∏è Esta arquitetura fornece uma base s√≥lida para o Sistema Vida Mais crescer e evoluir!**

---

**üìã Documento criado em: Janeiro de 2025**  
**üèóÔ∏è Respons√°vel: Arquitetura de Ferramentas Vida Mais**  
**üìß Contato: architecture@vidamais.com**
