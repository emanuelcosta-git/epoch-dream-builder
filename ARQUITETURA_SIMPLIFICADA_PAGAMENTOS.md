# üèóÔ∏è **ARQUITETURA SIMPLIFICADA - SISTEMA DE PAGAMENTOS VIDA MAIS**

## üéØ **FOCO: APENAS SISTEMA DE PAGAMENTOS**

Este documento define a **Arquitetura Simplificada** para o Sistema de Pagamentos Vida Mais, usando **APENAS LOVABLE (Frontend) + SUPABASE (Backend)**.

---

## üöÄ **STACK TECNOL√ìGICO SIMPLIFICADO**

### **1. FRONTEND - LOVABLE**
- **Framework**: LOVABLE (Low-Code Visual Application Builder)
- **Funcionalidades**: Apenas sistema de pagamentos
- **Interface**: Componentes visuais drag-and-drop
- **Responsividade**: Mobile-first design

### **2. BACKEND - SUPABASE**
- **Banco de Dados**: PostgreSQL (gerenciado)
- **Autentica√ß√£o**: Supabase Auth
- **API**: REST autom√°tico
- **Storage**: Apenas para anexos de pagamentos

---

## üé® **COMPONENTES LOVABLE - SISTEMA DE PAGAMENTOS**

### **1. Dashboard Principal**
- **M√©tricas**: Total de pagamentos, pendentes, aprovados
- **Gr√°ficos**: Pagamentos por m√™s, status
- **Alertas**: Pagamentos que precisam de aprova√ß√£o

### **2. Formul√°rio de Pagamento**
- **Campos**: Descri√ß√£o, valor, tipo, projeto, anexos
- **Valida√ß√£o**: Valor m√≠nimo/m√°ximo, campos obrigat√≥rios
- **Upload**: Anexar notas fiscais e documentos

### **3. Lista de Pagamentos**
- **Tabela**: Todos os pagamentos com filtros
- **Status**: Pendente, Aprovado, Rejeitado
- **A√ß√µes**: Editar, aprovar, rejeitar

### **4. Sistema de Aprova√ß√£o**
- **Interface**: Aprovar/rejeitar pagamentos
- **Justificativa**: Campo obrigat√≥rio para rejei√ß√£o
- **Notifica√ß√£o**: Email autom√°tico ap√≥s decis√£o

---

## üóÑÔ∏è **BANCO DE DADOS SUPABASE - TABELAS ESSENCIAIS**

### **1. Tabela: usuarios**
```sql
CREATE TABLE usuarios (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email TEXT UNIQUE NOT NULL,
    nome TEXT NOT NULL,
    perfil TEXT NOT NULL CHECK (perfil IN ('ariela', 'estagiario', 'sonia', 'ze', 'renata', 'admin')),
    ativo BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### **2. Tabela: projetos**
```sql
CREATE TABLE projetos (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    nome TEXT NOT NULL,
    orcamento_anual DECIMAL(12,2),
    ativo BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### **3. Tabela: pagamentos**
```sql
CREATE TABLE pagamentos (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    descricao TEXT NOT NULL,
    valor DECIMAL(10,2) NOT NULL,
    tipo TEXT NOT NULL CHECK (tipo IN ('fixo', 'variavel')),
    projeto_id UUID REFERENCES projetos(id),
    solicitante_id UUID REFERENCES usuarios(id),
    status TEXT DEFAULT 'pendente' CHECK (status IN ('pendente', 'aprovado', 'rejeitado')),
    aprovado_por UUID REFERENCES usuarios(id),
    data_aprovacao TIMESTAMP WITH TIME ZONE,
    justificativa_rejeicao TEXT,
    mes_ano TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### **4. Tabela: anexos**
```sql
CREATE TABLE anexos (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    pagamento_id UUID REFERENCES pagamentos(id) ON DELETE CASCADE,
    nome_arquivo TEXT NOT NULL,
    tipo_arquivo TEXT NOT NULL,
    url_arquivo TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

---

## üîê **AUTENTICA√á√ÉO SIMPLIFICADA - SUPABASE AUTH**

### **1. Perfis de Usu√°rio**
- **ariela**: Criar/editar pagamentos, anexar arquivos
- **estagiario**: Criar pagamentos vari√°veis
- **sonia**: Visualizar relat√≥rios
- **ze**: Visualizar e baixar relat√≥rios
- **renata**: Aprovar/rejeitar pagamentos > R$ 5.000
- **admin**: Configura√ß√µes do sistema

### **2. Row Level Security (RLS)**
```sql
-- Usu√°rios veem apenas seus pr√≥prios dados
CREATE POLICY "Usu√°rios veem apenas seus dados" ON usuarios
FOR SELECT USING (auth.uid()::text = id::text);

-- Pagamentos baseados no perfil
CREATE POLICY "Pagamentos por perfil" ON pagamentos
FOR ALL USING (
    CASE 
        WHEN auth.jwt() ->> 'perfil' = 'admin' THEN true
        WHEN auth.jwt() ->> 'perfil' = 'renata' THEN true
        WHEN auth.jwt() ->> 'perfil' = 'ariela' THEN solicitante_id::text = auth.uid()::text
        WHEN auth.jwt() ->> 'perfil' = 'estagiario' THEN solicitante_id::text = auth.uid()::text
        WHEN auth.jwt() ->> 'perfil' IN ('sonia', 'ze') THEN true
        ELSE false
    END
);
```

---

## üîÑ **FLUXO DE APROVA√á√ÉO - REGRAS DE NEG√ìCIO**

### **1. Cria√ß√£o de Pagamento**
1. **Ariela/Estagi√°rio** cria pagamento via LOVABLE
2. **Sistema valida** campos obrigat√≥rios
3. **Sistema verifica** se valor > R$ 5.000
4. **Se ‚â§ R$ 5.000**: Aprova√ß√£o autom√°tica
5. **Se > R$ 5.000**: Aguarda aprova√ß√£o de Renata

### **2. Aprova√ß√£o Autom√°tica**
- **Status**: "aprovado"
- **Timestamp**: Data/hora autom√°tica
- **Email**: Notifica√ß√£o para Sonia e Z√©
- **Log**: Registro autom√°tico no sistema

### **3. Aprova√ß√£o Manual**
- **Status**: "pendente"
- **Email**: Sistema envia para Renata
- **Resposta**: Renata aprova/rejeita via interface
- **Justificativa**: Obrigat√≥ria para rejei√ß√£o
- **Notifica√ß√£o**: Email para Sonia e Z√©

---

## üìß **SISTEMA DE EMAIL - SUPABASE EDGE FUNCTIONS**

### **1. Fun√ß√£o: Enviar Email de Aprova√ß√£o**
```javascript
// supabase/functions/enviar-email-aprovacao/index.js
export async function handler(event) {
    const { pagamento_id } = JSON.parse(event.body);
    
    // Buscar dados do pagamento
    const { data: pagamento } = await supabase
        .from('pagamentos')
        .select('*')
        .eq('id', pagamento_id)
        .single();
    
    // Enviar email baseado no status
    if (pagamento.status === 'aprovado') {
        await enviarEmail('sonia@vidamais.com, ze@vidamais.com', 
            'Pagamento Aprovado', 
            templatePagamentoAprovado(pagamento));
    } else if (pagamento.status === 'pendente') {
        await enviarEmail('renata@vidamais.com', 
            'Pagamento Pendente de Aprova√ß√£o', 
            templatePagamentoPendente(pagamento));
    }
    
    return { success: true };
}
```

### **2. Templates de Email**
- **Email para Renata**: Detalhes do pagamento + bot√µes aprovar/rejeitar
- **Email para Sonia/Z√©**: Relat√≥rio de pagamentos aprovados
- **Formato**: HTML responsivo com dados din√¢micos

---

## üì± **INTERFACE LOVABLE - COMPONENTES PRINCIPAIS**

### **1. P√°gina de Login**
- **Campo**: Email e senha
- **Valida√ß√£o**: Supabase Auth
- **Redirecionamento**: Dashboard ap√≥s login

### **2. Dashboard Principal**
- **Cards**: Total pagamentos, pendentes, aprovados
- **Gr√°fico**: Pagamentos por m√™s
- **Tabela**: √öltimos pagamentos
- **Bot√£o**: "Novo Pagamento"

### **3. Formul√°rio de Pagamento**
- **Campos**: Descri√ß√£o, valor, tipo, projeto, mes_ano
- **Upload**: Anexar arquivos (PDF, imagens)
- **Valida√ß√£o**: Campos obrigat√≥rios, valor m√≠nimo
- **Bot√µes**: Salvar, Cancelar

### **4. Lista de Pagamentos**
- **Filtros**: Status, m√™s, projeto, valor
- **Tabela**: Pagina√ß√£o, ordena√ß√£o
- **A√ß√µes**: Editar, aprovar, rejeitar
- **Export**: Excel/PDF

### **5. Tela de Aprova√ß√£o**
- **Detalhes**: Informa√ß√µes completas do pagamento
- **Anexos**: Visualizar arquivos
- **Decis√£o**: Aprovar ou Rejeitar
- **Justificativa**: Campo obrigat√≥rio para rejei√ß√£o

---

## üîí **SEGURAN√áA SIMPLIFICADA**

### **1. Autentica√ß√£o**
- **Supabase Auth**: Login com email/senha
- **JWT Tokens**: Sess√µes seguras
- **Logout**: Limpeza autom√°tica de tokens

### **2. Autoriza√ß√£o**
- **Perfis**: Controle de acesso por usu√°rio
- **RLS**: Dados filtrados automaticamente
- **Valida√ß√£o**: Campos obrigat√≥rios no frontend e backend

### **3. Dados**
- **Criptografia**: HTTPS autom√°tico do Supabase
- **Backup**: Autom√°tico e di√°rio
- **Logs**: Hist√≥rico de todas as a√ß√µes

---

## üìä **RELAT√ìRIOS SIMPLES**

### **1. Relat√≥rio Mensal**
- **Dados**: Pagamentos do m√™s
- **Formato**: Excel (CSV)
- **Filtros**: Status, projeto, tipo
- **Download**: Bot√£o direto na interface

### **2. Dashboard Executivo**
- **M√©tricas**: Totais e percentuais
- **Gr√°ficos**: Pagamentos por status, m√™s
- **Tempo real**: Atualiza√ß√£o autom√°tica
- **Responsivo**: Funciona em mobile

---

## üöÄ **IMPLEMENTA√á√ÉO - PASSOS SIMPLES**

### **Fase 1: Configura√ß√£o (1 semana)**
1. **Criar projeto Supabase**
2. **Configurar tabelas** com SQL fornecido
3. **Configurar RLS** e pol√≠ticas
4. **Criar projeto LOVABLE**

### **Fase 2: Funcionalidades Core (2 semanas)**
1. **Interface de login** com Supabase Auth
2. **Dashboard principal** com m√©tricas
3. **Formul√°rio de pagamento** com valida√ß√£o
4. **Lista de pagamentos** com filtros

### **Fase 3: Sistema de Aprova√ß√£o (1 semana)**
1. **Interface de aprova√ß√£o** para Renata
2. **Sistema de email** com Edge Functions
3. **Fluxo autom√°tico** vs manual
4. **Logs e auditoria**

### **Fase 4: Relat√≥rios e Finaliza√ß√£o (1 semana)**
1. **Relat√≥rios em Excel**
2. **Dashboard executivo**
3. **Testes e ajustes**
4. **Deploy em produ√ß√£o**

---

## üí∞ **CUSTOS ESTIMADOS - MENSAL**

### **Supabase**
- **Plano Pro**: $25/m√™s
- **Storage**: ~$5/m√™s (para anexos)
- **Total**: ~$30/m√™s

### **LOVABLE**
- **Licen√ßa**: $99/m√™s
- **Hosting**: $29/m√™s
- **Total**: ~$128/m√™s

### **Total Geral**: ~$158/m√™s

---

## ‚ö†Ô∏è **LIMITA√á√ïES E CONSIDERA√á√ïES**

### **1. LOVABLE**
- **Depend√™ncia**: Plataforma propriet√°ria
- **Customiza√ß√£o**: Limitada √†s funcionalidades dispon√≠veis
- **Escalabilidade**: Depende do plano contratado

### **2. Supabase**
- **Rate Limiting**: Plano gratuito tem limita√ß√µes
- **Storage**: Limite de 1GB no plano gratuito
- **Edge Functions**: Limite de execu√ß√µes

### **3. Mitiga√ß√µes**
- **Plano Pro**: Supabase para produ√ß√£o
- **Otimiza√ß√£o**: Queries eficientes
- **Cache**: Dados frequentes em cache local

---

## üéØ **VANTAGENS DA ARQUITETURA SIMPLIFICADA**

### **1. Desenvolvimento R√°pido**
- ‚úÖ **LOVABLE**: Interface visual em poucos dias
- ‚úÖ **Supabase**: Backend pronto para uso
- ‚úÖ **Integra√ß√£o**: Simples e direta

### **2. Custo-Efetivo**
- ‚úÖ **Sem equipe**: Desenvolvimento low-code
- ‚úÖ **Infraestrutura**: Gerenciada pelo Supabase
- ‚úÖ **Manuten√ß√£o**: M√≠nima

### **3. Funcionalidade Focada**
- ‚úÖ **Sistema de pagamentos**: Completo
- ‚úÖ **Aprova√ß√£o**: Autom√°tica e manual
- ‚úÖ **Relat√≥rios**: B√°sicos mas funcionais

---

## üéâ **CONCLUS√ÉO**

Esta arquitetura simplificada permite implementar o **Sistema de Pagamentos Vida Mais** em **4 semanas** usando apenas:

üöÄ **LOVABLE** para interface visual r√°pida  
‚òÅÔ∏è **Supabase** para backend robusto e seguro  
üìß **Edge Functions** para emails autom√°ticos  
üîí **RLS** para controle de acesso granular  

**üéØ Foco total no sistema de pagamentos, sem complexidades desnecess√°rias!**

---

**üìã Documento criado em: Janeiro de 2025**  
**üèóÔ∏è Respons√°vel: Arquitetura Simplificada Vida Mais**  
**üìß Contato: architecture@vidamais.com**
